#*
 * Copyright 2012 LinkedIn Corp.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
*#

<!DOCTYPE html> 
<html>
	<head lang="en">

#parse ("azkaban/webapp/servlet/velocity/style2.vm")
#parse ("azkaban/webapp/servlet/velocity/javascript.vm")

		<script type="text/javascript" src="${context}/js/jqueryui/jquery-ui-1.10.1.custom.js"></script>
		<script type="text/javascript" src="${context}/js/azkaban.nav.js"></script>
		<script type="text/javascript">
			var contextURL = "${context}";
			var currentTime = ${currentTime};
			var timezone = "${timezone}";
			var homeDir = "${homedir}";

#if ($allowproxy)
			$(function() {
				$('#changeUserBtn').click( function() {
				  $('#messageDialog').modal({
				      closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
				      position: ["20%",],
				      containerId: 'confirm-container',
				      containerCss: {
				        'height': '200px',
				        'width': '400px'
				      },
				      onShow: function (dialog) {
				      }
				    });
				});
				
				$('#submitChangeUserBtn').click( function() {
					var user = $('#proxyname').val();
					$.post(
						"",
						{'action': 'changeProxyUser', 'proxyname': user},
						function(data) {
							if (data.error) {
								$('#messageBox').text(data.error);
							}
							else {
								location.reload(true);
							}
						}
					);
				});
			});
#end
		</script>
	</head>
	<body>

#set ($current_page="$viewerName")
#parse ("azkaban/webapp/servlet/velocity/nav2.vm")

		<div class="container">

#if ($errorMsg)
			<div class="panel panel-danger">
				<div class="panel-heading">Error</div>
				<div class="panel-body">
					$errorMsg
				</div>
			</div>
#else
	#if ($error_message != "null")
			<div class="alert alert-danger">$error_message</div>
	#elseif ($success_message != "null")
			<div class="alert alert-success">$success_message</div>
	#end
#end

			<div class="page-header">
				<h1>HDFS Browser</h1>
			</div>

			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default" id="all-hdfsbrowser-content">
						<div class="panel-heading">
							<a id="goHomeLink" class="btn btn-xs btn-default" href="${context}/hdfs${homedir}">Home Directory</a>
	#if ($allowproxy)
							<div class="pull-right">
								<strong>Proxy user</strong> ${user}
								<button type="button" id="changeUserBtn" class="btn btn-xs btn-default">Change User</button>
							</div>
							<div class="clearfix"></div>
	#end
						</div>
						<div class="panel-body">
#set ($size = $paths.size() - 1)
							<a class="firstCrumb" href="${context}/hdfs/">/</a>#if($size >= 0)#foreach($i in [0 ..$size])<a href="$context/hdfs${paths.get($i)}">${segments.get($i)}</a><span>/</span>#end #end
						</div>
#if (!$no_fs)
						<table id="hdfs-dir" class="table table-condensed table-striped table-hover table-bordered">
							<thead>
								<tr>
									<th>File</th>
									<th>Permission</th>
									<th>Owner/Group</th>
									<th>Size</th>
									<th>Block Size</th>
									<th>Reps</th>
									<th>Modified Date</th>
								</tr>
							</thead>
							<tbody>
	#if ($subdirs)
		#foreach ($status in $subdirs)
								<tr>
									<td>
										<a href="${context}/hdfs${status.getPath().toUri().getPath()}">${status.path.name}#if($status.isDir())/#end</a>
									</td>
									<td>${status.permission}</td>
									<td>${status.owner}/${status.group}</td>
									<td>
			#if ($status.isDir())
										&ndash;
			#else
										$utils.displayBytes(${status.len})
			#end
									</td>
									<td>
			#if ($status.isDir())
										&ndash;
			#else
										$utils.displayBytes(${status.getBlockSize()})
			#end
									</td>
									<td>
			#if ($status.isDir())
										&ndash;
			#else
										${status.getReplication()}
			#end
									</td>
									<td>$utils.formatDateTime(${status.modificationTime})</td>
								</tr>
		#end
	#else
								<tr><td>No Files In This Directory</td></tr>
	#end
							</tbody>
						</table>
#end

					</div><!-- /.panel -->
				</div><!-- /.col-lg-12 -->
			</div><!-- /.row -->

			<div class="modal fade" id="messageDialog">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header" id="messageTitle">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title">Change proxy User</h4>
						</div>
						<div class="modal-body" id="messageDiv">
							<input id="proxyname" type="text" name="proxyname" val="${user}" class="form-control">
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							<button id="submitChangeUserBtn" class="btn btn-primary">Change User</button>
						</div>
					</div>
				</div>
			</div>

#parse ("azkaban/webapp/servlet/velocity/footer.vm")
		</div><!-- /.container -->
	</body>
</html>
